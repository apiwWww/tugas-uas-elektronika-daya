<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>CSV Realtime Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: Arial; background: #f0f0f0; padding: 20px; }
    .param-box { background: white; padding: 15px; margin: 15px 0; border-radius: 10px; box-shadow: 0 0 8px #ccc; }
    canvas { width: 100%; max-height: 250px; }
  </style>
</head>
<body>
  <h2>CSV Dashboard Generator</h2>
  <input id="csvUrl" placeholder="https://raw.githubusercontent.com/apiwWww/tugas-uas-elektronika-daya/refs/heads/main/data_simulasi%20(2).csv" style="width:70%" />
  <button onclick="loadCSV()">Load</button>
  <button onclick="toggleAuto()" id="autoBtn">Auto: OFF</button>

  <div id="container"></div>

<script>
let auto = false;
let timer = null;
let charts = {};

function toggleAuto(){
  auto = !auto;
  document.getElementById("autoBtn").innerText = "Auto: " + (auto?"ON":"OFF");
  if(auto){ timer = setInterval(loadCSV, 1000); }
  else{ clearInterval(timer); }
}

async function loadCSV(){
  const url = document.getElementById("csvUrl").value + "?cache="+Date.now();
  const res = await fetch(url);
  const text = await res.text();
  const rows = text.trim().split("
").map(r=>r.split(","));

  const header = rows[0];
  const data = rows.slice(1);

  const cols = {};
  header.forEach((h,i)=> cols[h] = data.map(r => r[i]));

  const container = document.getElementById("container");
  container.innerHTML = "";

  header.forEach((col, i)=>{
    if(i===0) return;
    let values = cols[col].map(Number);
    let last = values[values.length-1];

    let box = document.createElement("div");
    box.className = "param-box";
    box.innerHTML = `<h3>${col}</h3>
      <h1>${last.toFixed(2)}</h1>
      <canvas id="gauge_${col}"></canvas>
      <canvas id="chart_${col}"></canvas>`;
    container.appendChild(box);

    drawGauge("gauge_"+col, last);
    drawChart("chart_"+col, values);
  });
}

function drawGauge(id, val){
  let ctx = document.getElementById(id).getContext("2d");
  if(charts[id]) charts[id].destroy();
  charts[id] = new Chart(ctx, {
    type: "doughnut",
    data:{ labels:["Value","Rest"], datasets:[{ data:[val, 300-val] }]},
    options:{ cutout: "70%", plugins:{ legend:{display:false} } }
  });
}

function drawChart(id, values){
  let ctx = document.getElementById(id).getContext("2d");
  if(charts[id]) charts[id].destroy();
  charts[id] = new Chart(ctx, {
    type:"line",
    data:{ labels: values.map((_,i)=>i), datasets:[{ data: values }]},
    options:{ responsive:true }
  });
}
</script>

</body>
</html>
