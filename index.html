<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Dashboard Realtime - SIMULASI</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f0f2f5;
      padding: 20px;
      text-align: center;
    }
    h1 {
      color: #0066cc;
    }
    .dashboard {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 20px;
      max-width: 1200px;
      margin: 0 auto;
    }
    .card {
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      width: 220px;
    }
    .value {
      font-size: 28px;
      font-weight: bold;
      color: #0066cc;
      margin: 10px 0;
    }
    canvas {
      margin-top: 15px;
      height: 150px !important;
    }
  </style>
</head>
<body>

<h1>Dashboard Monitoring Realtime (Data Simulasi)</h1>
<div class="dashboard" id="dashboard"></div>

<script>
// Buat 4 card: Tegangan, Arus, Daya, Resistansi
const metrics = [
  { id: 'voltage', name: 'Tegangan', unit: 'V', color: 'rgba(0,102,204,1)', max: 300 },
  { id: 'current', name: 'Arus', unit: 'A', color: 'rgba(50,168,82,1)', max: 10 },
  { id: 'power', name: 'Daya', unit: 'W', color: 'rgba(255,153,0,1)', max: 3000 },
  { id: 'resistance', name: 'Resistansi', unit: 'Ω', color: 'rgba(220,50,50,1)', max: 300 }
];

// Simpan chart dan data
const charts = {};
const dataHistory = { voltage: [], current: [], power: [], resistance: [] };
const labels = [];

// Buat elemen card
const dashboard = document.getElementById('dashboard');
metrics.forEach(m => {
  const card = document.createElement('div');
  card.className = 'card';
  card.innerHTML = `
    <h3>${m.name}</h3>
    <div class="value" id="${m.id}Value">0.00</div>
    <div>${m.unit}</div>
    <canvas id="${m.id}Chart"></canvas>
  `;
  dashboard.appendChild(card);

  // Buat chart
  const ctx = document.getElementById(`${m.id}Chart`).getContext('2d');
  charts[m.id] = new Chart(ctx, {
    type: 'line',
    data: {
      labels: [],
       [{
        label: m.unit,
         [],
        borderColor: m.color,
        backgroundColor: m.color.replace('1)', '0.1)'),
        borderWidth: 2,
        pointRadius: 0,
        tension: 0.4
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      animation: false,
      scales: {
        y: { beginAtZero: true, display: false },
        x: { display: false }
      },
      plugins: { legend: { display: false } }
    }
  });
});

// Fungsi untuk generate data simulasi
function generateData() {
  const now = new Date();
  const timeLabel = now.toLocaleTimeString();

  // Simulasi Tegangan: sekitar 220V ±10V
  const voltage = 220 + (Math.random() - 0.5) * 20;
  // Simulasi Arus: sekitar 1A ±0.5A
  const current = Math.max(0.2, 1 + (Math.random() - 0.5) * 1);
  const power = voltage * current;
  const resistance = voltage / current;

  const values = { voltage, current, power, resistance };

  // Update tampilan & chart
  Object.keys(values).forEach(key => {
    const val = values[key];
    document.getElementById(`${key}Value`).textContent = val.toFixed(2);

    // Simpan data (maks 30 titik)
    dataHistory[key].push(val);
    if (dataHistory[key].length > 30) dataHistory[key].shift();

    // Update chart
    const chart = charts[key];
    chart.data. = dataHistory[key];
    chart.data.labels = Array(dataHistory[key].length).fill(''); // Sembunyikan label waktu
    chart.update();
  });
}

// Jalankan pertama kali
generateData();
// Update tiap 1 detik
setInterval(generateData, 1000);
</script>

</body>
</html>
