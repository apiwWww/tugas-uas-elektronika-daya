<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Dashboard Realtime CSV</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: Arial; background: #f0f0f0; padding: 20px; text-align: center; }
    .card {
      background: white; padding: 20px; margin: 15px; border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1); display: inline-block;
    }
    .gauge {
      width: 150px; height: 150px; border-radius: 50%;
      border: 10px solid #ddd; position: relative; margin: auto;
    }
    .needle {
      width: 4px; height: 60px; background: red; position: absolute;
      top: 20px; left: 50%; transform-origin: bottom;
    }
    .value { font-size: 22px; margin-top: 10px; font-weight: bold; }
  </style>
</head>
<body>

<h1>Dashboard Realtime dari CSV GitHub</h1>
<p>Update otomatis setiap 5 detik</p>

<hr>

<!-- ===================== VOLTAGE ====================== -->
<div class="card">
    <h2>Voltage (V)</h2>

    <div class="gauge">
        <div id="needle1" class="needle"></div>
    </div>
    <div id="val1" class="value">--</div>

    <canvas id="chart1" width="350" height="150"></canvas>
</div>

<!-- ===================== CURRENT ====================== -->
<div class="card">
    <h2>Current (A)</h2>

    <div class="gauge">
        <div id="needle2" class="needle"></div>
    </div>
    <div id="val2" class="value">--</div>

    <canvas id="chart2" width="350" height="150"></canvas>
</div>

<script>

const CSV_URL = "https://raw.githubusercontent.com/apiwWww/tugas-uas-elektronika-daya/refs/heads/main/data_simulasi.csv";

const ctx1 = document.getElementById('chart1').getContext('2d');
const ctx2 = document.getElementById('chart2').getContext('2d');

const chart1 = new Chart(ctx1, {
    type: 'line',
    data: { labels: [], datasets: [{ label: 'Voltage (V)', data: [] }] },
    options: { responsive: true }
});

const chart2 = new Chart(ctx2, {
    type: 'line',
    data: { labels: [], datasets: [{ label: 'Current (A)', data: [] }] },
    options: { responsive: true }
});


async function loadCSV() {
    const res = await fetch(CSV_URL);
    const text = await res.text();

    const rows = text.trim().split("\n").map(r => r.split(","));
    const data = rows.slice(1); // skip header

    const last = data[data.length - 1];

    const time = last[0];            // kolom time
    const voltage = parseFloat(last[1]); // kolom voltage
    const current = parseFloat(last[2]); // kolom current
    // const power = parseFloat(last[3]); // kalau mau tambah gauge ke-3

    // update gauge
    updateGauge("needle1", voltage);
    updateGauge("needle2", current);

    document.getElementById("val1").textContent = voltage;
    document.getElementById("val2").textContent = current;

    // update grafik
    chart1.data.labels.push(time);
    chart1.data.datasets[0].data.push(voltage);
    chart1.update();

    chart2.data.labels.push(time);
    chart2.data.datasets[0].data.push(current);
    chart2.update();
}

function updateGauge(id, value) {
    const deg = (value / 100) * 180 - 90;
    document.getElementById(id).style.transform = `rotate(${deg}deg)`;
}

loadCSV();
setInterval(loadCSV, 5000);

</script>

</body>
</html>
