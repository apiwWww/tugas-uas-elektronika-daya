<script>

const CSV_URL = "https://raw.githubusercontent.com/apiwWww/tugas-uas-elektronika-daya/refs/heads/main/data_simulasi%20(2).csv";

// chart setup
const ctx1 = document.getElementById('chart1').getContext('2d');
const ctx2 = document.getElementById('chart2').getContext('2d');

const chart1 = new Chart(ctx1, {
    type: 'line',
    data: { labels: [], datasets: [{ label: 'Parameter 1', data: [] }] },
    options: { responsive: true }
});

const chart2 = new Chart(ctx2, {
    type: 'line',
    data: { labels: [], datasets: [{ label: 'Parameter 2', data: [] }] },
    options: { responsive: true }
});

let dataRows = [];
let index = 0; // <-- ini penting

async function loadAllCSV() {
    const res = await fetch(CSV_URL);
    const text = await res.text();
    const rows = text.trim().split("\n").map(r => r.split(","));

    dataRows = rows.slice(1); // buang header
}

function updateStep() {

    if (index >= dataRows.length) {
        console.log("DATA SUDAH HABIS");
        return;
    }

    const row = dataRows[index];
    const time = row[0];
    const param1 = parseFloat(row[1]);
    const param2 = parseFloat(row[2]);

    updateGauge("needle1", param1);
    updateGauge("needle2", param2);

    document.getElementById("val1").textContent = param1;
    document.getElementById("val2").textContent = param2;

    chart1.data.labels.push(time);
    chart1.data.datasets[0].data.push(param1);
    chart1.update();

    chart2.data.labels.push(time);
    chart2.data.datasets[0].data.push(param2);
    chart2.update();

    index++; // <-- maju ke baris berikutnya
}

function updateGauge(id, value) {
    const deg = (value / 100) * 180 - 90;
    document.getElementById(id).style.transform = `rotate(${deg}deg)`;
}

// START
loadAllCSV().then(() => {
    updateStep(); // tampilkan baris pertama langsung
    setInterval(updateStep, 1000); // update tiap 1 detik
});

</script>
